{"changed":true,"filter":false,"title":"Game.js","tooltip":"/scripts/Game.js","value":"Game = function(game){\n    \n}\n\nGame.prototype = {\n\tinit:function(Level,lives){\n\t\tthis.Level=Level;\n\t\tthis.lives=lives;\n\t\tif(this.Level==null && this.lives==null){\n\t\t\tthis.Level=1;\n\t\t\tthis.lives=3;\n\t\t}\n\t\n\t\tconsole.log(this.Level + 'level');\n\t\t\tconsole.log(this.lives + 'vidas');\n\t\tthis.changeNextLevel=true;\n\t   this.levelmap = 'Level';\n\t\n\t  console.log(this.Level);\n\t   if(this.Level >0 ){\n\t   \t this.levelmap = 'Level' + this.Level;\n\t   }\n\t   \n\t},\n    create:function(){\n        this.game.physics.startSystem(Phaser.Physics.ARCADE);  \n        this.game.physics.arcade.gravity.y = 500;\n      \tthis.cursors = this.game.input.keyboard.createCursorKeys();\n       this.soundAttack=this.add.audio(\"soundAttack\");\n       this.soundTram=this.add.audio(\"soundTram\");\n           this.guntime=0;\n       this.loadlevel();\n       this.soundAttack.volume = 0.1;\n       this.player.body.setSize(30,38);\n       if(this.Level==3){\n       this.emitter = this.game.add.emitter(this.game.world.centerX, 0,400);\n       \tthis.emitter.width = this.game.world.width;\n       \tthis.emitter.makeParticles('rain');\n\n\tthis.emitter.minParticleScale = 0.4;\n\tthis.emitter.maxParticleScale = 0.5;\n\n\tthis.emitter.setYSpeed(300, 500);\n\tthis.emitter.setXSpeed(-5, 5);\n\n\tthis.emitter.minRotation = 0;\n\tthis.emitter.maxRotation = 0;\n this.emitter.gravity = 0;\n\tthis.emitter.start(false, 1600, 5, 0);\n\tthis.invunerable=false;\n}\n\n\n      this.canGo=false;\n      this.Goal;\n      \n      \n      \n        \n    },\n    loadlevel:function(){\n    \t\n    \t\n  console.log(this.levelmap);\n        this.map = this.game.add.tilemap(this.levelmap);\n     // Level 1\n     \n     this.map.addTilesetImage('desert','backGrounLevel1');\n       \tthis.map.addTilesetImage('tiles_spritesheet','tilesLevel1');\n       \t\tthis.map.addTilesetImage('cavebackground','backGrounLevel3');\n       \t\n\t\tthis.map.addTilesetImage('RockTile','tilesLevel2');\n       \n        \n   this.map.addTilesetImage('cavesalida','backGrounLevel2_1');\n    this.map.addTilesetImage('case2','backGrounLevel2_2');\n    \n\t    \n \n\tthis.backGroundLayer=this.map.createLayer('backgroundLayer');\n   \n   \n\n\tthis.collisionLayer = this.map.createLayer('collisionLayer');\n          \n\t\n\tthis.map.setCollisionBetween(1,100000,true,'collisionLayer');\n\t\t\t\t \n\t\t\t\t  \n\tthis.collisionLayer.resizeWorld();\n\t\t\t\t \n\tvar dataDoor=this.findObjectsByType('goal',this.map,'objectsLayer');\n\tthis.door=new Goal(game,dataDoor[0].x,dataDoor[0].y-200);\n\t\t\t\t \n\t\tvar keyData = this.findObjectsByType('key',this.map,'objectsLayer');\n\t\tthis.keyGroup=this.game.add.group();\n\t\tkeyData.forEach(function(data){\n\t\tvar key=new Key(this.game,data.x,data.y);\n\t\tthis.keyGroup.add(key);\n\t\t},this);\n\t\n\t\n\t\tvar playerData=this.findObjectsByType('player',this.map,'objectsLayer');\n\t\tthis.player = new Hero(this.game,playerData[0].x,playerData[0].y);  \n\t\t\n\t\t\t\t  \n\t\t\n\t\t\t\t\n\t\t if(this.Level>=2){\n\t\t\tvar tramData = this.findObjectsByType('tram',this.map,'objectsLayer');\n\t\t\tthis.tramGroup=this.game.add.group();\n\t     \ttramData.forEach(function(data){\n\t\t\tvar tram=new Bounce(this.game,data.x,data.y);\n\t\n\t\t\tthis.tramGroup.add(tram);\n\t\t},this);\n\t\t\n\t\tvar spineData = this.findObjectsByType('spike',this.map,'objectsLayer');\n\t\tthis.spineGroup = this.game.add.group();\n\t\tspineData.forEach(function(data){\n\t\t\tvar spine=new Spine(this.game,data.x,data.y,'spike');\n\t\t\tthis.spineGroup.add(spine);\n\t\t},this);\n\t\t\n\t\t\t\t\t }\t\n\t\t\t\t\t \n\t\t\t\t\t \n\n\t\t\t\t\t \n\t\t\t///\n\tvar enemyData = this.findObjectsByType('enemy',this.map,'objectsLayer');\n\t\tthis.enemyGroup = this.game.add.group();\n\t\tenemyData.forEach(function(data){\n\t\t\n\t\t \n\t\t\tvar enemy=new Enemy(this.game,data.x,data.y,this.game.rnd.integerInRange(1,2),this.player);\n\t\t\tthis.enemyGroup.add(enemy);\n\t\t},this);\n\t\t\t\t\t \n\t\t\t\t\t \n\t\t\t\t\t\tthis.game.camera.follow(this.player);\n\t\t\t\t\t\tthis.weaponsGroup=this.game.add.group();\n\t\t\t\t\t\n\t\t\t\t\n    },\n    update:function(){\n    \tif(this.cursors.down.isDown){\n       \n          this.createBullets();\n          \n      }\n       \tthis.game.physics.arcade.collide(this.enemyGroup,this.collisionLayer);\n      \n\t\t\n      this.game.physics.arcade.collide(this.door,this.collisionLayer);\n         this.game.physics.arcade.collide(this.spineGroup,this.collisionLayer);\n       this.game.physics.arcade.collide(this.tramGroup,this.collisionLayer);\n       this.game.physics.arcade.collide(this.player,this.collisionLayer);\n        this.game.physics.arcade.collide(this.keyGroup,this.collisionLayer);\n       \tthis.game.physics.arcade.collide(this.player,this.tramGroup,this.Bounce,null,this);\n       \t\t \n       \n      \n    \n       \t\n        this.game.physics.arcade.overlap(this.player,this.spineGroup,function(){\n      this.player.kill();\n   \n    },null,this);\n    \n     this.game.physics.arcade.overlap(this.player,this.enemyGroup,function(player,enemy){\n     \tenemy.kill();\n     this.lives-=1;\n     console.log(this.lives);\n    },null,this);\n    \n     this.game.physics.arcade.overlap(this.player,this.door,function(){\n       if(this.keyGroup.length === 0){\n       \tthis.changeLevel();\n       } \n   \n    },null,this);\n       \n       this.game.physics.arcade.overlap(this.weaponsGroup,this.enemyGroup,function(bullet,enemy){\n       bullet.kill();\n    \n       enemy.kill();\n       \n    },null,this);\n    \n       \n     this.game.physics.arcade.overlap(this.player,this.keyGroup,function(player,key){\n       key.destroy();\n     console.log(this.keyGroup.length);\n      \n       \n    },null,this);\n      \n      \n    },\n  \n  /* render:function() {\n\n   \n        this.game.debug.bodyInfo(this.player, 32, 32);\n        this.game.debug.body(this.player);\n\n}, */\nfindObjectsByType: function(targetType, tilemap, layer){\n\t\tvar result = [];\n\t\ttilemap.objects[layer].forEach(function(element){\n\t\t\tif(element.properties.type == targetType) {\n\t\t\t\telement.y -= tilemap.tileHeight; \n\t\t\t\tresult.push(element);\n\t\t\t}\n\t\t}, this);\n\t\treturn result;\n},\n\tBounce:function(){\n\t\n\t if(this.player.body.touching.down ){\n\t \tthis.soundTram.play();\n\t \tthis.player.body.velocity.y=-500;\n\t    \n\t }\n\t \n\t}\n\t,\n    createBullets:function(){\n      \n    if(this.game.time.now >this.guntime){\n        this.player.Shoot();\n        this.soundAttack.play();\n        var gun=this.weaponsGroup.getFirstDead();\n      if(gun)\n      {\n         \n        gun.reset(this.player.x,this.player.y-5);\n        gun.dirrecion=this.player.scale.x;\n        \n      }\n     else{\n     \t  \n       gun=new Weapon(game,this.player.x,this.player.y-5,this.player.scale.x,'weapon');\n        \n      this.weaponsGroup.add(gun);\n       \n     } \n    \n      \n      this.guntime = this.game.time.now + 1000;\n      \n      \n      }\n       \n      console.log(this.weaponsGroup.length);\n      \n } ,\n   changeLevel:function(){\n   \tconsole.log(this.enemyGroup.length);\n   \t if(this.changeNextLevel){\n\t \tthis.changeNextLevel = false;\n\t \tthis.Level++;\n\t \tthis.game.state.start('Game',true,false,this.Level,this.lives);//true para limpiar todo el munod and false \n\t \t\n\t }\t\n   } \n}","undoManager":{"mark":11,"position":100,"stack":[[{"start":{"row":200,"column":11},"end":{"row":200,"column":12},"action":"remove","lines":["k"],"id":7291}],[{"start":{"row":200,"column":11},"end":{"row":200,"column":12},"action":"insert","lines":["d"],"id":7292}],[{"start":{"row":200,"column":12},"end":{"row":200,"column":13},"action":"insert","lines":["e"],"id":7293}],[{"start":{"row":200,"column":13},"end":{"row":200,"column":14},"action":"insert","lines":["s"],"id":7294}],[{"start":{"row":200,"column":14},"end":{"row":200,"column":15},"action":"insert","lines":["t"],"id":7295}],[{"start":{"row":200,"column":15},"end":{"row":200,"column":16},"action":"insert","lines":["r"],"id":7296}],[{"start":{"row":200,"column":16},"end":{"row":200,"column":17},"action":"insert","lines":["i"],"id":7297}],[{"start":{"row":200,"column":16},"end":{"row":200,"column":17},"action":"remove","lines":["i"],"id":7298}],[{"start":{"row":200,"column":16},"end":{"row":200,"column":17},"action":"insert","lines":["o"],"id":7299}],[{"start":{"row":200,"column":17},"end":{"row":200,"column":18},"action":"insert","lines":["y"],"id":7300}],[{"start":{"row":200,"column":18},"end":{"row":200,"column":20},"action":"insert","lines":["()"],"id":7301}],[{"start":{"row":200,"column":20},"end":{"row":200,"column":21},"action":"insert","lines":[";"],"id":7302}],[{"start":{"row":82,"column":0},"end":{"row":83,"column":67},"action":"remove","lines":["\t//\tthis.collisionLayer = this.map.createLayer('collisionLayer');","\t//\tthis.collisionLayer1 = this.map.createLayer('collisionKiller');"],"id":7303}],[{"start":{"row":85,"column":1},"end":{"row":85,"column":65},"action":"remove","lines":["\t//\tthis.collisionLayer= this.map.createLayer('collisionLayer');"],"id":7304}],[{"start":{"row":87,"column":5},"end":{"row":87,"column":69},"action":"remove","lines":[" //\tthis.map.setCollisionBetween(1,1000,true,'collisionLayer2');"],"id":7305}],[{"start":{"row":90,"column":5},"end":{"row":90,"column":21},"action":"remove","lines":[" \t///create door"],"id":7306}],[{"start":{"row":93,"column":5},"end":{"row":94,"column":23},"action":"remove","lines":[" \t//","\t\t\t\t  //Create the keys"],"id":7307}],[{"start":{"row":100,"column":1},"end":{"row":104,"column":2},"action":"remove","lines":["\t///","\t\t//Goal","\t\t ","\t\t//","\t\t"],"id":7308}],[{"start":{"row":101,"column":1},"end":{"row":101,"column":26},"action":"remove","lines":["\t//Positioning the player"],"id":7309}],[{"start":{"row":104,"column":2},"end":{"row":105,"column":20},"action":"remove","lines":["\t//","\t\t\t\t  //////////////"],"id":7310}],[{"start":{"row":106,"column":2},"end":{"row":106,"column":3},"action":"remove","lines":["\t"],"id":7311}],[{"start":{"row":108,"column":4},"end":{"row":108,"column":5},"action":"remove","lines":["\t"],"id":7312}],[{"start":{"row":108,"column":3},"end":{"row":108,"column":4},"action":"remove","lines":["\t"],"id":7313}],[{"start":{"row":108,"column":2},"end":{"row":108,"column":3},"action":"remove","lines":["\t"],"id":7314}],[{"start":{"row":109,"column":3},"end":{"row":109,"column":4},"action":"remove","lines":["\t"],"id":7315}],[{"start":{"row":109,"column":2},"end":{"row":109,"column":3},"action":"remove","lines":["\t"],"id":7316}],[{"start":{"row":109,"column":1},"end":{"row":109,"column":2},"action":"remove","lines":["\t"],"id":7317}],[{"start":{"row":109,"column":1},"end":{"row":109,"column":2},"action":"insert","lines":["\t"],"id":7318}],[{"start":{"row":111,"column":1},"end":{"row":111,"column":2},"action":"insert","lines":[" "],"id":7319}],[{"start":{"row":111,"column":2},"end":{"row":111,"column":3},"action":"insert","lines":[" "],"id":7320}],[{"start":{"row":111,"column":3},"end":{"row":111,"column":4},"action":"insert","lines":[" "],"id":7321}],[{"start":{"row":111,"column":4},"end":{"row":111,"column":5},"action":"insert","lines":[" "],"id":7322}],[{"start":{"row":111,"column":5},"end":{"row":111,"column":6},"action":"insert","lines":[" "],"id":7323}],[{"start":{"row":103,"column":2},"end":{"row":103,"column":3},"action":"remove","lines":["\t"],"id":7324}],[{"start":{"row":97,"column":1},"end":{"row":97,"column":2},"action":"remove","lines":["\t"],"id":7325}],[{"start":{"row":98,"column":2},"end":{"row":98,"column":3},"action":"remove","lines":["\t"],"id":7326}],[{"start":{"row":95,"column":2},"end":{"row":95,"column":3},"action":"remove","lines":["\t"],"id":7327}],[{"start":{"row":86,"column":4},"end":{"row":86,"column":5},"action":"remove","lines":["t"],"id":7328}],[{"start":{"row":86,"column":3},"end":{"row":86,"column":4},"action":"remove","lines":["\t"],"id":7329}],[{"start":{"row":86,"column":2},"end":{"row":86,"column":3},"action":"remove","lines":["\t"],"id":7330}],[{"start":{"row":86,"column":2},"end":{"row":86,"column":3},"action":"insert","lines":["t"],"id":7331}],[{"start":{"row":83,"column":1},"end":{"row":83,"column":2},"action":"remove","lines":["\t"],"id":7332}],[{"start":{"row":86,"column":1},"end":{"row":86,"column":2},"action":"remove","lines":["\t"],"id":7333}],[{"start":{"row":89,"column":6},"end":{"row":89,"column":7},"action":"remove","lines":["\t"],"id":7334}],[{"start":{"row":89,"column":5},"end":{"row":89,"column":6},"action":"remove","lines":[" "],"id":7335}],[{"start":{"row":89,"column":4},"end":{"row":89,"column":5},"action":"remove","lines":[" "],"id":7336}],[{"start":{"row":89,"column":3},"end":{"row":89,"column":4},"action":"remove","lines":["\t"],"id":7337}],[{"start":{"row":89,"column":2},"end":{"row":89,"column":3},"action":"remove","lines":["\t"],"id":7338}],[{"start":{"row":89,"column":1},"end":{"row":89,"column":2},"action":"remove","lines":["\t"],"id":7339}],[{"start":{"row":92,"column":5},"end":{"row":92,"column":6},"action":"remove","lines":[" "],"id":7340}],[{"start":{"row":92,"column":4},"end":{"row":92,"column":5},"action":"remove","lines":[" "],"id":7341}],[{"start":{"row":92,"column":3},"end":{"row":92,"column":4},"action":"remove","lines":["\t"],"id":7342}],[{"start":{"row":92,"column":2},"end":{"row":92,"column":3},"action":"remove","lines":["\t"],"id":7343}],[{"start":{"row":92,"column":1},"end":{"row":92,"column":2},"action":"remove","lines":["\t"],"id":7344}],[{"start":{"row":91,"column":5},"end":{"row":91,"column":6},"action":"remove","lines":[" "],"id":7345}],[{"start":{"row":91,"column":4},"end":{"row":91,"column":5},"action":"remove","lines":[" "],"id":7346}],[{"start":{"row":91,"column":3},"end":{"row":91,"column":4},"action":"remove","lines":["\t"],"id":7347}],[{"start":{"row":91,"column":2},"end":{"row":91,"column":3},"action":"remove","lines":["\t"],"id":7348}],[{"start":{"row":91,"column":1},"end":{"row":91,"column":2},"action":"remove","lines":["\t"],"id":7349}],[{"start":{"row":91,"column":0},"end":{"row":91,"column":1},"action":"remove","lines":["\t"],"id":7350}],[{"start":{"row":152,"column":6},"end":{"row":153,"column":28},"action":"remove","lines":["  //\tthis.game.physics.arcade.collide(this.player,this.spineGroup,","\t\t//\tthis.killme,null,this);"],"id":7351}],[{"start":{"row":166,"column":6},"end":{"row":166,"column":28},"action":"remove","lines":["console.log(\"muerto\");"],"id":7352},{"start":{"row":166,"column":6},"end":{"row":166,"column":7},"action":"insert","lines":["t"]}],[{"start":{"row":166,"column":7},"end":{"row":166,"column":8},"action":"insert","lines":["h"],"id":7353}],[{"start":{"row":166,"column":8},"end":{"row":166,"column":9},"action":"insert","lines":["i"],"id":7354}],[{"start":{"row":166,"column":9},"end":{"row":166,"column":10},"action":"insert","lines":["s"],"id":7355}],[{"start":{"row":166,"column":10},"end":{"row":166,"column":11},"action":"insert","lines":["."],"id":7356}],[{"start":{"row":166,"column":11},"end":{"row":166,"column":12},"action":"insert","lines":["p"],"id":7357}],[{"start":{"row":166,"column":12},"end":{"row":166,"column":13},"action":"insert","lines":["l"],"id":7358}],[{"start":{"row":166,"column":13},"end":{"row":166,"column":14},"action":"insert","lines":["a"],"id":7359}],[{"start":{"row":166,"column":14},"end":{"row":166,"column":15},"action":"insert","lines":["y"],"id":7360}],[{"start":{"row":166,"column":15},"end":{"row":166,"column":16},"action":"insert","lines":["e"],"id":7361}],[{"start":{"row":166,"column":16},"end":{"row":166,"column":17},"action":"insert","lines":["r"],"id":7362}],[{"start":{"row":166,"column":17},"end":{"row":166,"column":18},"action":"insert","lines":["."],"id":7363}],[{"start":{"row":166,"column":18},"end":{"row":166,"column":19},"action":"insert","lines":["l"],"id":7364}],[{"start":{"row":166,"column":19},"end":{"row":166,"column":20},"action":"insert","lines":["i"],"id":7365}],[{"start":{"row":166,"column":19},"end":{"row":166,"column":20},"action":"remove","lines":["i"],"id":7366}],[{"start":{"row":166,"column":18},"end":{"row":166,"column":19},"action":"remove","lines":["l"],"id":7367}],[{"start":{"row":166,"column":18},"end":{"row":166,"column":19},"action":"insert","lines":["l"],"id":7368}],[{"start":{"row":166,"column":19},"end":{"row":166,"column":20},"action":"insert","lines":["o"],"id":7369}],[{"start":{"row":166,"column":19},"end":{"row":166,"column":20},"action":"remove","lines":["o"],"id":7370}],[{"start":{"row":166,"column":18},"end":{"row":166,"column":19},"action":"remove","lines":["l"],"id":7371}],[{"start":{"row":166,"column":18},"end":{"row":166,"column":19},"action":"insert","lines":["k"],"id":7372}],[{"start":{"row":166,"column":19},"end":{"row":166,"column":20},"action":"insert","lines":["i"],"id":7373}],[{"start":{"row":166,"column":20},"end":{"row":166,"column":21},"action":"insert","lines":["l"],"id":7374}],[{"start":{"row":166,"column":21},"end":{"row":166,"column":22},"action":"insert","lines":["l"],"id":7375}],[{"start":{"row":166,"column":22},"end":{"row":166,"column":24},"action":"insert","lines":["()"],"id":7376}],[{"start":{"row":166,"column":24},"end":{"row":166,"column":25},"action":"insert","lines":[";"],"id":7377}],[{"start":{"row":231,"column":6},"end":{"row":231,"column":7},"action":"insert","lines":["¿"],"id":7378}],[{"start":{"row":231,"column":6},"end":{"row":231,"column":7},"action":"remove","lines":["¿"],"id":7379}],[{"start":{"row":231,"column":5},"end":{"row":231,"column":6},"action":"remove","lines":[" "],"id":7380}],[{"start":{"row":231,"column":4},"end":{"row":231,"column":5},"action":"remove","lines":["{"],"id":7381}],[{"start":{"row":230,"column":40},"end":{"row":230,"column":41},"action":"insert","lines":["{"],"id":7382}],[{"start":{"row":231,"column":5},"end":{"row":231,"column":6},"action":"remove","lines":[" "],"id":7383},{"start":{"row":231,"column":5},"end":{"row":231,"column":6},"action":"insert","lines":[" "]}],[{"start":{"row":231,"column":6},"end":{"row":231,"column":7},"action":"insert","lines":[" "],"id":7384}],[{"start":{"row":231,"column":7},"end":{"row":231,"column":8},"action":"insert","lines":[" "],"id":7385}],[{"start":{"row":236,"column":9},"end":{"row":236,"column":43},"action":"remove","lines":["gun.dirrecion=this.player.scale.x;"],"id":7386}],[{"start":{"row":237,"column":49},"end":{"row":238,"column":0},"action":"insert","lines":["",""],"id":7387},{"start":{"row":238,"column":0},"end":{"row":238,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":238,"column":8},"end":{"row":238,"column":42},"action":"insert","lines":["gun.dirrecion=this.player.scale.x;"],"id":7388}],[{"start":{"row":264,"column":3},"end":{"row":264,"column":31},"action":"remove","lines":["console.log('change level');"],"id":7389}],[{"start":{"row":191,"column":6},"end":{"row":191,"column":7},"action":"remove","lines":[" "],"id":7390}],[{"start":{"row":191,"column":5},"end":{"row":191,"column":6},"action":"remove","lines":[" "],"id":7391}]]},"ace":{"folds":[],"scrolltop":2875.4544961353977,"scrollleft":0,"selection":{"start":{"row":242,"column":8},"end":{"row":242,"column":8},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":209,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1467442302500}